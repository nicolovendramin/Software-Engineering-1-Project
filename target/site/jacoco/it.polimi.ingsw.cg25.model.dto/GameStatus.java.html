<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GameStatus.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">cg25</a> &gt; <a href="index.source.html" class="el_package">it.polimi.ingsw.cg25.model.dto</a> &gt; <span class="el_source">GameStatus.java</span></div><h1>GameStatus.java</h1><pre class="source lang-java linenums">package it.polimi.ingsw.cg25.model.dto;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import org.jgrapht.Graphs;

import it.polimi.ingsw.cg25.model.MatchCD4;
import it.polimi.ingsw.cg25.model.PlayerCD4;
import it.polimi.ingsw.cg25.model.dto.dtobonus.DTOBonus;

/**
 * 
 * @author Giovanni
 *
 */
public class GameStatus implements DTO {

	/**
	 * Serial number for serial communication
	 */
	private static final long serialVersionUID = -5336621975628010780L;
	/**
	 * The player who requests the game status
	 */
	private final DTOPlayerCD4 requestingPlayer;
	/**
	 * A List containing the other players
	 */
	private final List&lt;DTOPlayerCD4&gt; otherPlayers;
	/**
	 * A reference to the DTO board of the game
	 */
	private final DTOBoardCD4 board;
	/**
	 * is the match running?
	 */
	private boolean isRunning;
	/**
	 * is it the last round?
	 */
	private boolean isLastRound;
	/**
	 * a List of players ordered by their rank
	 */
	private final List&lt;DTOPlayerCD4&gt; highScores;
	
	/**
	 * GameStatus class constructor
	 * @param match a reference to a precise running match
	 * @param requestingPlayer the player whose statistics have to be printed
	 * @exception NullPointerException when match or requestingPlayer is null
	 */
<span class="fc" id="L55">	public GameStatus(MatchCD4 match, PlayerCD4 requestingPlayer) {</span>
<span class="fc bfc" id="L56" title="All 2 branches covered.">		if(match == null)</span>
<span class="fc" id="L57">			throw new NullPointerException(&quot;You can't create a game status without a valid match!&quot;);</span>
<span class="fc bfc" id="L58" title="All 2 branches covered.">		if(requestingPlayer == null)</span>
<span class="fc" id="L59">			throw new NullPointerException(&quot;Who is requesting the game status?&quot;);</span>
		
		//Check the match status when game status is created
		//It's used to display the end game message
<span class="fc bfc" id="L63" title="All 2 branches covered.">		this.isRunning = match.isRunning() ? true : false;</span>
		//It's used to display the last round message
<span class="fc bfc" id="L65" title="All 2 branches covered.">		this.isLastRound = match.isLastRound() ? true : false;</span>
		
<span class="fc bfc" id="L67" title="All 2 branches covered.">		if(!this.isRunning)</span>
<span class="fc" id="L68">			this.highScores = DTOPlayerCD4.convertAll(match.whoWon());</span>
<span class="fc" id="L69">		else this.highScores = new ArrayList&lt;&gt;();</span>
		
<span class="fc" id="L71">		this.requestingPlayer = new DTOPlayerCD4(requestingPlayer);</span>
<span class="fc" id="L72">		this.otherPlayers = DTOPlayerCD4.convertAll(match.getPlayers());</span>
		//Rimuovi da otherPlayer il player corrente
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">		for(DTOPlayerCD4 pl : otherPlayers) {</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">			if(pl.equals(requestingPlayer)) {</span>
<span class="fc" id="L76">				otherPlayers.remove(pl);</span>
<span class="fc" id="L77">				break;</span>
			}
		}
<span class="fc" id="L80">		this.board = new DTOBoardCD4(match.getBoard());</span>
		
<span class="fc" id="L82">	}</span>
	
	/**
	 * The overrided toString is used in order to create a kind of user-friendly interface
	 * when using CLI. It shows up all the game statistics to the players
	 */
	@Override
	public String toString() {
<span class="fc" id="L90">		StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L91">		sb.append(&quot;\n&quot;);</span>
<span class="fc" id="L92">		sb.append(&quot;******************************************************************\n&quot;);</span>
<span class="fc" id="L93">		sb.append(&quot;*                         GAME STATUS                            *\n&quot;);</span>
<span class="fc" id="L94">		sb.append(&quot;******************************************************************\n&quot;);</span>
<span class="fc" id="L95">		sb.append(&quot;\n&quot;);</span>
		
<span class="pc bpc" id="L97" title="1 of 2 branches missed.">		if(isLastRound)</span>
<span class="nc" id="L98">			sb.append(lastRoundMessage());</span>
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">		if(!isRunning)</span>
<span class="nc" id="L100">			sb.append(finalMessage());</span>
		
		//PLAYERS' INFORMATION
<span class="fc" id="L103">		sb.append(playersInfo());</span>
		
		//REGIONS' INFORMATION
<span class="fc" id="L106">		sb.append(regionsInfo());</span>
		
		//CONSIGLI
<span class="fc" id="L109">		sb.append(councilsInfo());</span>
		
		//PERCORSO NOBILTA'
<span class="fc" id="L112">		sb.append(nobilityTrackInfo());</span>
		
		//CITTA' E GRAFO
<span class="fc" id="L115">		sb.append(citiesAndGraphInfo());</span>
		
		//Set is Running
		
<span class="fc" id="L119">		return sb.toString();</span>
	}
	
	/**
	 * This method is used to print the whole players' statistics
	 * @return a StringBuilder object
	 */
	private StringBuilder playersInfo() {
<span class="fc" id="L127">		StringBuilder sb = new StringBuilder();</span>
		int index;
		
		//CURRENT PLAYER INFORMATION
<span class="fc" id="L131">		sb.append(&quot;Player stats:\n&quot;);</span>
<span class="fc" id="L132">		sb.append(requestingPlayer);</span>
			
		//PERMIT COPERTE E SCOPERTE DEL CURRENT PLAYER
		//PERMIT NON USATE
<span class="fc" id="L136">		sb.append(&quot;\tPermits to be used: \n&quot;);</span>
<span class="fc" id="L137">		index = 1;</span>
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">		for(DTOPermitCard p : requestingPlayer.getPermitsToBeUsed()) {</span>
<span class="nc" id="L139">			sb.append(&quot;\t\t&quot; + index + &quot;) &quot; + p.toString() + &quot;\n&quot;);</span>
<span class="nc" id="L140">			index++;</span>
		}
		//PERMIT USATE
<span class="fc" id="L143">		sb.append(&quot;\tUsed permits: \n&quot;);</span>
<span class="fc" id="L144">		index = 1;</span>
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">		for(DTOPermitCard p : requestingPlayer.getUsedPermits()) {</span>
<span class="nc" id="L146">			sb.append(&quot;\t\t&quot; + index + &quot;) &quot; + p.toString() + &quot;\n&quot;);</span>
<span class="nc" id="L147">			index++;</span>
		}
			
		//OTHER PLAYERS INFORMATION
<span class="fc" id="L151">		sb.append(&quot;\n&quot;);</span>
<span class="fc" id="L152">		sb.append(&quot;Other players' stats:\n&quot;);</span>
<span class="fc bfc" id="L153" title="All 2 branches covered.">		for(DTOPlayerCD4 pl : otherPlayers) {</span>
<span class="fc" id="L154">			sb.append(&quot;Name: &quot; + pl.getName() + &quot;\n&quot;);</span>
<span class="fc" id="L155">			sb.append(&quot;\tColor: &quot; + pl.getPlayerColor().printTag() + &quot;\n&quot;);</span>
<span class="fc" id="L156">			sb.append(&quot;\tVictory points: &quot; + pl.getPocket().getVictoryPoints() + &quot;\n&quot;);</span>
<span class="fc" id="L157">			sb.append(&quot;\tNobility points: &quot; + pl.getPocket().getNobilityRank() + &quot;\n&quot;);</span>
<span class="fc" id="L158">			sb.append(&quot;\tCoins: &quot; + pl.getPocket().getCoins() + &quot;\n&quot;);</span>
<span class="fc" id="L159">			sb.append(&quot;\tAvailable assistants: &quot; + pl.getPocket().getAssistants() + &quot;\n&quot;);</span>
		}
<span class="fc" id="L161">		sb.append(&quot;\n&quot;);</span>
		
<span class="fc" id="L163">		return sb;</span>
	}
	
	/**
	 * This method is used to print regions' information
	 * @return a StringBuilder object
	 */
	private StringBuilder regionsInfo() {
<span class="fc" id="L171">		StringBuilder sb = new StringBuilder();</span>
		int index;
		
		//REGIONS' INFORMATION
<span class="fc" id="L175">		sb.append(&quot;Regions' information:\n&quot;);</span>
<span class="fc" id="L176">		index = 1;</span>
<span class="fc bfc" id="L177" title="All 2 branches covered.">		for(DTORegion r : this.board.getRegions()) {</span>
<span class="fc" id="L178">			sb.append(&quot;\t&quot; + index + &quot;) Name: &quot; + r.getName() + &quot;, Cities: &quot;);</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">			for(DTOCity c : r.getCities())</span>
<span class="fc" id="L180">				sb.append(c.getName() + &quot;, &quot;);</span>
<span class="fc" id="L181">			sb.append(&quot;Region's bonus: &quot;);</span>
<span class="fc bfc" id="L182" title="All 2 branches covered.">			for(DTOBonus b : r.getBonusCard().getBonuses())</span>
<span class="fc" id="L183">				sb.append(b + &quot;, &quot;);</span>
<span class="fc" id="L184">			sb.setLength(sb.length() - 2);</span>
<span class="fc" id="L185">			sb.append(&quot;\n&quot;);</span>
<span class="fc" id="L186">			int index2 = 1;</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">			for(DTOPermitCard p : r.getFaceUpPermits()) {</span>
<span class="fc" id="L188">				sb.append(&quot;\t\t&quot; + index2 + &quot;) &quot; + p + &quot;\n&quot;);</span>
<span class="fc" id="L189">				index2++;</span>
			}
<span class="fc" id="L191">			sb.append(&quot;\n&quot;);</span>
<span class="fc" id="L192">			index++;</span>
		}
		
<span class="fc" id="L195">		return sb;</span>
	}
	
	/**
	 * This method is used to print councils' information
	 * @return a StringBuilder object
	 */
	private StringBuilder councilsInfo() {
<span class="fc" id="L203">		StringBuilder sb = new StringBuilder();</span>
		int index;
		
		//CONSIGLI
<span class="fc" id="L207">		sb.append(&quot;Councils:\n&quot;);</span>
<span class="fc" id="L208">		index = 1;</span>
		List&lt;DTOCouncelor&gt; invertedCoun;
		
<span class="fc" id="L211">		sb.append(&quot;\t&quot; + index + &quot;) King's council: &quot;);</span>
<span class="fc" id="L212">		invertedCoun = new ArrayList&lt;&gt;(board.getKingCouncil().getCouncelors());</span>
		//Inverti consiglieri
<span class="fc" id="L214">		Collections.reverse(invertedCoun);</span>
<span class="fc bfc" id="L215" title="All 2 branches covered.">		for(DTOCouncelor c : invertedCoun) {</span>
<span class="fc" id="L216">			sb.append(c.getColor().printTag() + &quot;, &quot;);</span>
		}
<span class="fc" id="L218">		sb.setLength(sb.length() - 2);</span>
<span class="fc" id="L219">		sb.append(&quot;\n&quot;);</span>
<span class="fc" id="L220">		sb.append(&quot;\t\t&quot; + &quot;King Reward: &quot;);</span>
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">		if(board.getKingReward() == null)</span>
<span class="nc" id="L222">			sb.append(&quot;No available cards&quot;);</span>
		else {
<span class="fc bfc" id="L224" title="All 2 branches covered.">			for(DTOBonus b : board.getKingReward().getBonuses()) {</span>
<span class="fc" id="L225">				sb.append(b + &quot;, &quot;);</span>
			}
<span class="fc" id="L227">			sb.setLength(sb.length() - 2);</span>
<span class="fc" id="L228">			sb.append(&quot;\n&quot;);</span>
		}
		
<span class="fc bfc" id="L231" title="All 2 branches covered.">		for(DTORegion reg : board.getRegions()) {</span>
<span class="fc" id="L232">			sb.append(&quot;\t&quot; + index + &quot;) &quot; + reg.getName() + &quot;: &quot;);</span>
<span class="fc" id="L233">			invertedCoun = new ArrayList&lt;&gt;(reg.getCouncil().getCouncelors());</span>
			//Inverti consiglieri
<span class="fc" id="L235">			Collections.reverse(invertedCoun);</span>
<span class="fc bfc" id="L236" title="All 2 branches covered.">			for(DTOCouncelor c : invertedCoun) {</span>
<span class="fc" id="L237">				sb.append(c.getColor().printTag() + &quot;, &quot;);</span>
			}
<span class="fc" id="L239">			index++;</span>
<span class="fc" id="L240">			sb.setLength(sb.length() - 2);</span>
<span class="fc" id="L241">			sb.append(&quot;\n&quot;);</span>
		}
<span class="fc" id="L243">		sb.append(&quot;\n&quot;);</span>
		
<span class="fc" id="L245">		return sb;</span>
	}

	/**
	 * This method is used to print the nobility track
	 * @return a StringBuilder object
	 */
	private StringBuilder nobilityTrackInfo() {
<span class="fc" id="L253">		StringBuilder sb = new StringBuilder();</span>

		//PERCORSO NOBILTA'
<span class="fc" id="L256">		sb.append(&quot;Nobility Track:\n&quot;);</span>
<span class="fc bfc" id="L257" title="All 2 branches covered.">		for(DTONobilityCell nc : board.getNobilityTrack()) {</span>
<span class="fc bfc" id="L258" title="All 2 branches covered.">			if(nc.getBonus().isEmpty())</span>
<span class="fc" id="L259">				sb.append(&quot;\t&quot; + nc.getId() + &quot;) Bonus: none\n&quot;);</span>
			else {
<span class="fc" id="L261">				sb.append(&quot;\t&quot; + nc.getId() + &quot;) Bonus: &quot;);</span>
<span class="fc bfc" id="L262" title="All 2 branches covered.">				for(DTOBonus b : nc.getBonus()) {</span>
<span class="fc" id="L263">					sb.append(b + &quot;, &quot;);</span>
				}
<span class="fc" id="L265">				sb.setLength(sb.length() - 2);</span>
<span class="fc" id="L266">				sb.append(&quot;\n&quot;);</span>
			}
		}
<span class="fc" id="L269">		sb.append(&quot;\n&quot;);</span>
		
<span class="fc" id="L271">		return sb;</span>
	}
	
	/**
	 * This method is used to print the last round message
	 * @return a StringBuilder object whose toString is the last round message
	 */
	private StringBuilder lastRoundMessage() {
<span class="nc" id="L279">		StringBuilder sb = new StringBuilder();</span>
		
<span class="nc" id="L281">		sb.append(&quot;*************************** LAST ROUND ***************************\n&quot;);</span>
<span class="nc" id="L282">		sb.append(&quot;\n&quot;);</span>
		
<span class="nc" id="L284">		return sb;</span>
	}
	
	/**
	 * This method is used to print the game over message
	 * @return a StringBuilder object whose toString is the game over message
	 */
	private StringBuilder finalMessage() {
<span class="nc" id="L292">		StringBuilder sb = new StringBuilder();</span>
		
<span class="nc" id="L294">		sb.append(&quot;*************************** GAME OVER ****************************\n&quot;);</span>
<span class="nc" id="L295">		sb.append(&quot;The winner is: &quot; + highScores.get(0).getName() + &quot;, Victory Points: &quot; </span>
<span class="nc" id="L296">				+ highScores.get(0).getPocket().getVictoryPoints() + &quot;\n&quot;);</span>
<span class="nc" id="L297">		sb.append(&quot;Other players:\n&quot;);</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">		for(int i = 1; i &lt; highScores.size(); i++)</span>
<span class="nc" id="L299">			sb.append(&quot;\t&quot; + i + &quot;) &quot; + highScores.get(i).getName() + &quot;, Victory Points: &quot;</span>
<span class="nc" id="L300">					+ highScores.get(i).getPocket().getVictoryPoints() + &quot;\n&quot;);</span>
<span class="nc" id="L301">		sb.append(&quot;\n&quot;);</span>
		
<span class="nc" id="L303">		return sb;</span>
	}
	
	/**
	 * This method is used to print cities and graph information
	 * @return a StringBuilder object
	 */
	private StringBuilder citiesAndGraphInfo() {
<span class="fc" id="L311">		StringBuilder sb = new StringBuilder();</span>
		
		//CITTA' E GRAFO
<span class="fc" id="L314">		sb.append(&quot;Directly connected cities:\n&quot;);</span>
<span class="fc bfc" id="L315" title="All 2 branches covered.">		for(DTOCity c : board.getCities()) {</span>
<span class="fc" id="L316">			List&lt;DTOCity&gt; neighbors = Graphs.neighborListOf(board.getRoadNetwork(), c);</span>
			//Se la città è la città del re
<span class="fc bfc" id="L318" title="All 2 branches covered.">			if(board.getKingCity().getName().equals(c.getName()))</span>
<span class="fc" id="L319">				sb.append(&quot;\t&quot; + c.getName() + &quot; [KING] -&gt; &quot;);</span>
<span class="fc" id="L320">			else sb.append(&quot;\t&quot; + c.getName() + &quot; -&gt; &quot;);</span>
<span class="fc bfc" id="L321" title="All 2 branches covered.">			for(DTOCity connCity : neighbors) {</span>
<span class="fc" id="L322">				sb.append(connCity.getName() + &quot;, &quot;);</span>
			}
<span class="fc" id="L324">			sb.setLength(sb.length() - 2);</span>
<span class="fc" id="L325">			sb.append(&quot;\n&quot;);</span>
<span class="fc" id="L326">			sb.append(&quot;\t\tCity's color: &quot; + c.getColor().getCityColor().printTag() +</span>
<span class="fc" id="L327">					&quot;, Color Reward: &quot;);</span>
<span class="fc bfc" id="L328" title="All 2 branches covered.">			if(c.getColor().getColorReward().isEmpty())</span>
<span class="fc" id="L329">				sb.append(&quot;none&quot;);</span>
			else {
<span class="fc bfc" id="L331" title="All 2 branches covered.">				for(DTOBonus b : c.getColor().getColorReward())</span>
<span class="fc" id="L332">					sb.append(b + &quot;, &quot;);</span>
<span class="fc" id="L333">				sb.setLength(sb.length() - 2);</span>
			}
<span class="fc" id="L335">			sb.append(&quot;\n&quot;);</span>
					
			//BONUS CITTA'
<span class="fc" id="L338">			sb.append(&quot;\t\tCity's Bonus: &quot;);</span>
<span class="fc bfc" id="L339" title="All 2 branches covered.">			if(c.getBonuses().isEmpty())</span>
<span class="fc" id="L340">				sb.append(&quot;none&quot;);</span>
			else {
<span class="fc bfc" id="L342" title="All 2 branches covered.">				for(DTOBonus b : c.getBonuses())</span>
<span class="fc" id="L343">					sb.append(b + &quot;, &quot;);</span>
<span class="fc" id="L344">				sb.setLength(sb.length() - 2);</span>
			}
<span class="fc" id="L346">			sb.append(&quot;\n&quot;);</span>
			
<span class="fc" id="L348">			sb.append(&quot;\t\tCity's Emporiums: &quot;);</span>
<span class="pc bpc" id="L349" title="1 of 2 branches missed.">			if(c.getEmporiums().isEmpty())</span>
<span class="fc" id="L350">				sb.append(&quot;none&quot;);</span>
			else { 
<span class="nc bnc" id="L352" title="All 2 branches missed.">				for(DTOEmporium emp : c.getEmporiums())</span>
<span class="nc" id="L353">					sb.append(emp.getColor().printTag() + &quot;, &quot;);</span>
<span class="nc" id="L354">				sb.setLength(sb.length() - 2);</span>
			}
<span class="fc" id="L356">			sb.append(&quot;\n&quot;);</span>
		}
<span class="fc" id="L358">		sb.append(&quot;\n&quot;);</span>
		
<span class="fc" id="L360">		return sb;</span>
	}

	/**
	 * @return the DTOBoard related to this GameStatus
	 */
	public DTOBoardCD4 getBoard() {
<span class="fc" id="L367">		return board;</span>
	}
	
	/**
	 * @return the requesting player
	 */
	public DTOPlayerCD4 getRequestingPlayer() {
<span class="fc" id="L374">		return requestingPlayer;</span>
	}

	/**
	 * @return the other players who are taking part in the game
	 */
	public List&lt;DTOPlayerCD4&gt; getOtherPlayers() {
<span class="fc" id="L381">		return otherPlayers;</span>
	}
	
	/**
	 * is the match running?
	 * @return true or false
	 */
	public boolean isRunning() {
<span class="fc" id="L389">		return this.isRunning;</span>
	}
	
	/**
	 * @return the sorted List of DTO players who took part in the game
	 * in order to show their rank
	 */
	public List&lt;DTOPlayerCD4&gt; getHighScorers() {
<span class="fc" id="L397">		return this.highScores;</span>
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>